{% extends 'monitoring_app/base.html' %}
{% load widget_tweaks %}

{% block content %}
<style>
    /* Page background */
    body {
        background: linear-gradient(180deg, #e6f3fa 0%, #b3e0f2 100%);
        min-height: 100vh;
    }

    /* Header styling */
    .sliding-header {
        animation: slideIn 0.8s ease-out;
        margin-bottom: 3rem;
        text-align: center;
    }

    .sliding-header h1 {
        font-size: 2.8rem;
        font-weight: 700;
        color: #1e40af;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        background: linear-gradient(90deg, #1e40af, #06b6d4);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .sliding-header p {
        color: #4b5563;
        font-size: 1.2rem;
        font-style: italic;
        opacity: 0.9;
    }

    /* Card styling */
    .card {
        border: none;
        border-radius: 16px;
        background: #ffffff;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        max-width: 1000px;
        margin: 0 auto;
    }

    .card:hover {
        transform: translateY(-8px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }

    .card-header {
        border-radius: 16px 16px 0 0;
        padding: 1.5rem;
        background: linear-gradient(135deg, #1e40af, #06b6d4);
        color: white;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .card-header::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(90deg, #1e40af, #06b6d4);
        animation: shimmer 2.5s infinite linear;
    }

    .card-header h5 {
        font-weight: 600;
        letter-spacing: 1px;
        text-transform: uppercase;
    }

    .card-body {
        padding: 2rem;
    }

    /* Form elements */
    .form-label {
        font-weight: 500;
        color: #1f2937;
        transition: color 0.3s ease, transform 0.3s ease;
        display: inline-flex;
        align-items: center;
    }

    .form-label:hover {
        color: #06b6d4;
        transform: translateX(3px);
    }

    .form-label::before {
        content: '\f773';
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        margin-right: 8px;
        color: #06b6d4;
        font-size: 0.9rem;
        opacity: 0.8;
    }

    .form-control, .form-select {
        border-radius: 10px;
        padding: 0.8rem;
        border: 2px solid #e5e7eb;
        background: #f9fafb;
        transition: border-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
    }

    .form-control:focus, .form-select:focus {
        border-color: #06b6d4;
        box-shadow: 0 0 10px rgba(6, 182, 212, 0.4);
        transform: scale(1.02);
        background: #ffffff;
    }

    /* Buttons */
    .btn-primary {
        padding: 0.8rem 2rem;
        border-radius: 10px;
        background: linear-gradient(135deg, #1e40af, #06b6d4);
        border: none;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(6, 182, 212, 0.4);
        background: linear-gradient(135deg, #06b6d4, #1e40af);
    }

    .btn-primary::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: 0.5s;
    }

    .btn-primary:hover::after {
        left: 100%;
    }

    /* Alerts */
    .alert {
        border-radius: 10px;
        padding: 1.2rem;
        margin-bottom: 2rem;
        animation: fadeIn 0.6s ease-in;
        background: #ffffff;
        border-left: 4px solid #06b6d4;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .alert-success {
        border-left-color: #10b981;
    }

    .alert-danger {
        border-left-color: #ef4444;
    }

    /* Parameters section */
    .parameters-section {
        background: #f1f5f9;
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
        animation: fadeIn 0.6s ease-in;
    }

    .parameters-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, #1e40af, #06b6d4);
        animation: shimmer 2.5s infinite linear;
    }

    .user-parameters .col-md-4 {
        animation: fadeIn 0.5s ease-in;
        animation-fill-mode: both;
    }

    .user-parameters .col-md-4:nth-child(1) { animation-delay: 0.1s; }
    .user-parameters .col-md-4:nth-child(2) { animation-delay: 0.2s; }
    .user-parameters .col-md-4:nth-child(3) { animation-delay: 0.3s; }
    .user-parameters .col-md-4:nth-child(4) { animation-delay: 0.4s; }
    .user-parameters .col-md-4:nth-child(5) { animation-delay: 0.5s; }
    .user-parameters .col-md-4:nth-child(6) { animation-delay: 0.6s; }
    .user-parameters .col-md-4:nth-child(7) { animation-delay: 0.7s; }
    .user-parameters .col-md-4:nth-child(8) { animation-delay: 0.8s; }
    .user-parameters .col-md-4:nth-child(9) { animation-delay: 0.9s; }
    .user-parameters .col-md-4:nth-child(10) { animation-delay: 1.0s; }

    /* Animations */
    @keyframes slideIn {
        from { transform: translateY(-30px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    /* Tooltip styling */
    [data-bs-toggle="tooltip"] {
        position: relative;
    }

    [data-bs-toggle="tooltip"]:hover::after {
        content: attr(data-bs-title);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: #1e40af;
        color: white;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 0.8rem;
        z-index: 1000;
        white-space: nowrap;
        animation: fadeIn 0.3s ease-in;
    }
</style>

<div class="sliding-header">
    <h1>Add Data</h1>
    <p>Add new water quality data for a user</p>
</div>

{% if messages %}
    <div class="messages mb-4">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    </div>
{% endif %}

<div class="card">
    <div class="card-header">
        <h5>Add Data</h5>
    </div>
    <div class="card-body">
        <form id="add-data-form">
            {% csrf_token %}
            <div class="mb-4">
                <label for="user_id" class="form-label" data-bs-toggle="tooltip" data-bs-title="Select a user to add data for">Select User</label>
                {{ form.user_id|add_class:"form-select" }}
            </div>
            
            <div id="parameters-section" class="parameters-section" style="display: none;">
                {% for user in users %}
                <div class="user-parameters" data-user-id="{{ user.id }}" style="display: none;">
                    <div class="row">
                        {% if user.show_ph %}
                        <div class="col-md-4 mb-3">
                            <label for="ph_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter pH value (0-14)">pH</label>
                            {{ form.ph|add_class:"form-control" }}
                        </div>
                        {% endif %}
                        {% if user.show_cod %}
                        <div class="col-md-4 mb-3">
                            <label for="cod_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter COD value (mg/L)">COD (mg/L)</label>
                            {{ form.cod|add_class:"form-control" }}
                        </div>
                        {% endif %}
                        {% if user.show_bod %}
                        <div class="col-md-4 mb-3">
                            <label for="bod_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter BOD value (mg/L)">BOD (mg/L)</label>
                            {{ form.bod|add_class:"form-control" }}
                        </div>
                        {% endif %}
                        {% if user.show_tss %}
                        <div class="col-md-4 mb-3">
                            <label for="tss_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter TSS value (mg/L)">TSS (mg/L)</label>
                            {{ form.tss|add_class:"form-control" }}
                        </div>
                        {% endif %}
                        {% if user.show_flow1 %}
                        <div class="col-md-4 mb-3">
                            <label for="flow1_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter Flow 1 rate (L/min)">Flow 1 (L/min)</label>
                            {{ form.flow1|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow1_total_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter total Flow 1 volume (L)">Flow 1 Total (L)</label>
                            {{ form.flow1_total|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow1_daily_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter daily Flow 1 volume (L)">Flow 1 Daily (L)</label>
                            {{ form.flow1_daily|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow1_monthly_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter monthly Flow 1 volume (L)">Flow 1 Monthly (L)</label>
                            {{ form.flow1_monthly|add_class:"form-control" }}
                        </div>
                        {% endif %}
                        {% if user.show_flow2 %}
                        <div class="col-md-4 mb-3">
                            <label for="flow2_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter Flow 2 rate (L/min)">Flow 2 (L/min)</label>
                            {{ form.flow2|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow2_total_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter total Flow 2 volume (L)">Flow 2 Total (L)</label>
                            {{ form.flow2_total|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow2_daily_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter daily Flow 2 volume (L)">Flow 2 Daily (L)</label>
                            {{ form.flow2_daily|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow2_monthly_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter monthly Flow 2 volume (L)">Flow 2 Monthly (L)</label>
                            {{ form.flow2_monthly|add_class:"form-control" }}
                        </div>
                        {% endif %}
                        {% if user.show_flow3 %}
                        <div class="col-md-4 mb-3">
                            <label for="flow3_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter Flow 3 rate (L/min)">Flow 3 (L/min)</label>
                            {{ form.flow3|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow3_total_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter total Flow 3 volume (L)">Flow 3 Total (L)</label>
                            {{ form.flow3_total|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow3_daily_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter daily Flow 3 volume (L)">Flow 3 Daily (L)</label>
                            {{ form.flow3_daily|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow3_monthly_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter monthly Flow 3 volume (L)">Flow 3 Monthly (L)</label>
                            {{ form.flow3_monthly|add_class:"form-control" }}
                        </div>
                        {% endif %}
                        {% if user.show_flow4 %}
                        <div class="col-md-4 mb-3">
                            <label for="flow4_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter Flow 4 rate (L/min)">Flow 4 (L/min)</label>
                            {{ form.flow4|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow4_total_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter total Flow 4 volume (L)">Flow 4 Total (L)</label>
                            {{ form.flow4_total|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow4_daily_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter daily Flow 4 volume (L)">Flow 4 Daily (L)</label>
                            {{ form.flow4_daily|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow4_monthly_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter monthly Flow 4 volume (L)">Flow 4 Monthly (L)</label>
                            {{ form.flow4_monthly|add_class:"form-control" }}
                        </div>
                        {% endif %}
                        {% if user.show_flow5 %}
                        <div class="col-md-4 mb-3">
                            <label for="flow5_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter Flow 5 rate (L/min)">Flow 5 (L/min)</label>
                            {{ form.flow5|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow5_total_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter total Flow 5 volume (L)">Flow 5 Total (L)</label>
                            {{ form.flow5_total|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow5_daily_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter daily Flow 5 volume (L)">Flow 5 Daily (L)</label>
                            {{ form.flow5_daily|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow5_monthly_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter monthly Flow 5 volume (L)">Flow 5 Monthly (L)</label>
                            {{ form.flow5_monthly|add_class:"form-control" }}
                        </div>
                        {% endif %}
                        {% if user.show_flow6 %}
                        <div class="col-md-4 mb-3">
                            <label for="flow6_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter Flow 6 rate (L/min)">Flow 6 (L/min)</label>
                            {{ form.flow6|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow6_total_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter total Flow 6 volume (L)">Flow 6 Total (L)</label>
                            {{ form.flow6_total|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow6_daily_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter daily Flow 6 volume (L)">Flow 6 Daily (L)</label>
                            {{ form.flow6_daily|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow6_monthly_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter monthly Flow 6 volume (L)">Flow 6 Monthly (L)</label>
                            {{ form.flow6_monthly|add_class:"form-control" }}
                        </div>
                        {% endif %}
                        {% if user.show_flow7 %}
                        <div class="col-md-4 mb-3">
                            <label for="flow7_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter Flow 7 rate (L/min)">Flow 7 (L/min)</label>
                            {{ form.flow7|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow7_total_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter total Flow 7 volume (L)">Flow 7 Total (L)</label>
                            {{ form.flow7_total|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow7_daily_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter daily Flow 7 volume (L)">Flow 7 Daily (L)</label>
                            {{ form.flow7_daily|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow7_monthly_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter monthly Flow 7 volume (L)">Flow 7 Monthly (L)</label>
                            {{ form.flow7_monthly|add_class:"form-control" }}
                        </div>
                        {% endif %}
                        {% if user.show_flow8 %}
                        <div class="col-md-4 mb-3">
                            <label for="flow8_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter Flow 8 rate (L/min)">Flow 8 (L/min)</label>
                            {{ form.flow8|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow8_total_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter total Flow 8 volume (L)">Flow 8 Total (L)</label>
                            {{ form.flow8_total|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow8_daily_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter daily Flow 8 volume (L)">Flow 8 Daily (L)</label>
                            {{ form.flow8_daily|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow8_monthly_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter monthly Flow 8 volume (L)">Flow 8 Monthly (L)</label>
                            {{ form.flow8_monthly|add_class:"form-control" }}
                        </div>
                        {% endif %}
                        {% if user.show_flow9 %}
                        <div class="col-md-4 mb-3">
                            <label for="flow9_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter Flow 9 rate (L/min)">Flow 9 (L/min)</label>
                            {{ form.flow9|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow9_total_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter total Flow 9 volume (L)">Flow 9 Total (L)</label>
                            {{ form.flow9_total|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow9_daily_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter daily Flow 9 volume (L)">Flow 9 Daily (L)</label>
                            {{ form.flow9_daily|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow9_monthly_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter monthly Flow 9 volume (L)">Flow 9 Monthly (L)</label>
                            {{ form.flow9_monthly|add_class:"form-control" }}
                        </div>
                        {% endif %}
                        {% if user.show_flow10 %}
                        <div class="col-md-4 mb-3">
                            <label for="flow10_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter Flow 10 rate (L/min)">Flow 10 (L/min)</label>
                            {{ form.flow10|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow10_total_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter total Flow 10 volume (L)">Flow 10 Total (L)</label>
                            {{ form.flow10_total|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow10_daily_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter daily Flow 10 volume (L)">Flow 10 Daily (L)</label>
                            {{ form.flow10_daily|add_class:"form-control" }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="flow10_monthly_{{ user.id }}" class="form-label" data-bs-toggle="tooltip" data-bs-title="Enter monthly Flow 10 volume (L)">Flow 10 Monthly (L)</label>
                            {{ form.flow10_monthly|add_class:"form-control" }}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    $('#user_id').change(function() {
        var userId = $(this).val();
        $('.user-parameters').hide();
        $('#parameters-section').hide();
        if (userId) {
            $('#parameters-section').show();
            $('.user-parameters[data-user-id="' + userId + '"]').show();
        }
    });

    $('#add-data-form').submit(function(e) {
        e.preventDefault();
        var formData = $(this).serialize();
        $.ajax({
            url: '{% url "submit_data" %}',
            method: 'POST',
            data: formData,
            success: function(response) {
                if (response.success) {
                    alert('Data submitted successfully!');
                    $('#add-data-form')[0].reset();
                    $('.user-parameters').hide();
                    $('#parameters-section').hide();
                } else {
                    alert('Error: ' + response.error);
                }
            },
            error: function(xhr, status, error) {
                alert('Error submitting data: ' + error);
            }
        });
    });

    // Enable Bootstrap tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.forEach(function (tooltipTriggerEl) {
        new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>
{% endblock %}